<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>لعبة شبكة التمويه</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    direction: rtl;
    background: #f0f0f0;
    margin-top: 50px;
  }
  #game {
    display: inline-block;
    border: 3px solid #333;
    background: #fff;
  }
  .row {
    display: flex;
  }
  .cell {
    width: 60px;
    height: 60px;
    border: 1px solid #999;
    box-sizing: border-box;
    position: relative;
  }
  .player {
    background: #4caf50;
  }
  .trap {
    background: #e53935;
  }
  .trap.hidden {
    background: #fff;
  }
  .invisible {
    opacity: 0.5;
  }
  #info {
    margin-top: 15px;
    font-size: 18px;
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>لعبة شبكة التمويه</h1>
<p>استخدم مفاتيح الأسهم لتحرك اللاعب 🟩</p>
<p>اضغط زر "تفعيل التمويه" لتجنب الفخاخ 🔥 لمدة 5 ثواني</p>

<div id="game"></div>

<div id="info"></div>
<button id="cloakBtn">تفعيل التمويه</button>

<script>
  const gridSize = 5;
  const game = document.getElementById('game');
  const info = document.getElementById('info');
  const cloakBtn = document.getElementById('cloakBtn');

  let playerPos = {x: 0, y: 0};
  let traps = [];
  let cloakActive = false;
  let gameOver = false;

  // إنشاء الشبكة
  const cells = [];
  for (let y = 0; y < gridSize; y++) {
    const row = document.createElement('div');
    row.className = 'row';
    const rowCells = [];
    for (let x = 0; x < gridSize; x++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      row.appendChild(cell);
      rowCells.push(cell);
    }
    game.appendChild(row);
    cells.push(rowCells);
  }

  // وضع فخاخ عشوائية
  function placeTraps() {
    traps = [];
    while (traps.length < 5) {
      let tx = Math.floor(Math.random() * gridSize);
      let ty = Math.floor(Math.random() * gridSize);
      // لا تضع فخ عند موقع اللاعب أو فخ موجود
      if ((tx !== playerPos.x || ty !== playerPos.y) && !traps.some(t => t.x === tx && t.y === ty)) {
        traps.push({x: tx, y: ty});
      }
    }
  }

  // رسم الشبكة
  function draw() {
    for (let y = 0; y < gridSize; y++) {
      for (let x = 0; x < gridSize; x++) {
        cells[y][x].className = 'cell';
        cells[y][x].textContent = '';
      }
    }
    // رسم الفخاخ (مخفية أو ظاهرة حسب التمويه)
    traps.forEach(t => {
      if (cloakActive) {
        cells[t.y][t.x].classList.add('trap', 'hidden');
      } else {
        cells[t.y][t.x].classList.add('trap');
      }
    });
    // رسم اللاعب
    cells[playerPos.y][playerPos.x].classList.add('player');
    if (cloakActive) {
      cells[playerPos.y][playerPos.x].classList.add('invisible');
    }
  }

  // تحرك اللاعب
  function movePlayer(dx, dy) {
    if (gameOver) return;

    const newX = playerPos.x + dx;
    const newY = playerPos.y + dy;

    if (newX < 0 || newX >= gridSize || newY < 0 || newY >= gridSize) return;

    playerPos = {x: newX, y: newY};

    // تحقق من الفخ
    if (!cloakActive && traps.some(t => t.x === newX && t.y === newY)) {
      gameOver = true;
      info.textContent = "💥 وقعت في فخ! انتهت اللعبة!";
      alert("💥 انتهت اللعبة! حاول مرة أخرى.");
    } else {
      info.textContent = cloakActive ? "🛡️ التمويه مفعّل! أنت محمي." : "تحرك بحذر!";
    }

    draw();
  }

  // استمع لمفاتيح الأسهم
  window.addEventListener('keydown', (e) => {
    if (gameOver) return;

    switch(e.key) {
      case 'ArrowUp': movePlayer(0, -1); break;
      case 'ArrowDown': movePlayer(0, 1); break;
      case 'ArrowLeft': movePlayer(-1, 0); break;
      case 'ArrowRight': movePlayer(1, 0); break;
    }
  });

  // تفعيل التمويه
  cloakBtn.addEventListener('click', () => {
    if (gameOver) return;
    if (cloakActive) {
      alert("🛡️ التمويه قيد التفعيل بالفعل!");
      return;
    }
    cloakActive = true;
    info.textContent = "🛡️ التمويه مفعّل! أنت محمي لمدة 5 ثواني.";
    draw();

    setTimeout(() => {
      cloakActive = false;
      info.textContent = "تم انتهاء التمويه، احذر الفخاخ!";
      draw();
    }, 5000);
  });

  placeTraps();
  draw();
  info.textContent = "ابدأ بالتحرك!";

</script>

</body>
</html>
